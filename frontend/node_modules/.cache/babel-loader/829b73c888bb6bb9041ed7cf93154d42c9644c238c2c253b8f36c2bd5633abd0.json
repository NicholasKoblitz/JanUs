{"ast":null,"code":"import _objectSpread from\"/home/n/repos/JanUs/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import{Comet}from\"../api\";import'../styles/GroupChat.css';import Navbar from\"./Navbar\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const GroupChat=()=>{const INIT_STATE={text:\"\"};const[formData,setFormData]=useState(INIT_STATE);const[messages,setMessages]=useState();const[trigger,setTrigger]=useState();const uid=localStorage.getItem(\"uid\");const{guid}=useParams();const ws=new WebSocket(\"wss://janusapi.herokuapp.com/api/ws/chat\");useEffect(()=>{function fetchGroupMessagesAndSend(){ws.onopen=function(evt){ws.send(guid);};ws.onmessage=function(evt){// console.log(JSON.parse(evt.data)) \nlet data=JSON.parse(evt.data);if(data===[]){setMessages(null);}else{setMessages(data);}};}fetchGroupMessagesAndSend();});useEffect(()=>{function fetchGroupMessagesOnce(){setTimeout(function(){let messageBody=document.querySelector('.message-list');if(messageBody){messageBody.scrollTop=messageBody.scrollHeight-messageBody.clientHeight;}},700);}fetchGroupMessagesOnce();},[]);const sendMessage=async()=>{await Comet.sendMessage(guid,formData.text,uid);};const handleChange=e=>{const{name,value}=e.target;setFormData(formData=>_objectSpread(_objectSpread({},formData),{},{[name]:value}));let messageBody=document.querySelector('.message-list');if(messageBody){messageBody.scrollTop=messageBody.scrollHeight-messageBody.clientHeight;}};const handleSubmit=async e=>{e.preventDefault();sendMessage();setFormData(INIT_STATE);let messageBody=document.querySelector('.message-list');if(messageBody){messageBody.scrollTop=messageBody.scrollHeight-messageBody.clientHeight;}};const details=messages?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"ul\",{className:\"message-list\",children:messages.map(message=>{if(!message.deletedAt){if(message.sender===uid.toLowerCase()){return/*#__PURE__*/_jsx(\"li\",{className:\"sender\",children:message.data.text});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"message-name\",children:message.sender}),/*#__PURE__*/_jsx(\"li\",{className:\"receiver\",children:message.data.text})]});}})})}):null;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"GroupChat\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"GroupChat-messages\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"messages-border\"}),details]}),/*#__PURE__*/_jsxs(\"form\",{className:\"GroupChat-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{name:\"text\",placeholder:\"Type Message\",value:formData.text,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{children:\"Send\"})]})]})]});};export default GroupChat;","map":{"version":3,"names":["React","useEffect","useState","useParams","Comet","Navbar","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","GroupChat","INIT_STATE","text","formData","setFormData","messages","setMessages","trigger","setTrigger","uid","localStorage","getItem","guid","ws","WebSocket","fetchGroupMessagesAndSend","onopen","evt","send","onmessage","data","JSON","parse","fetchGroupMessagesOnce","setTimeout","messageBody","document","querySelector","scrollTop","scrollHeight","clientHeight","sendMessage","handleChange","e","name","value","target","_objectSpread","handleSubmit","preventDefault","details","children","className","map","message","deletedAt","sender","toLowerCase","onSubmit","placeholder","onChange"],"sources":["/home/n/repos/JanUs/frontend/src/components/GroupChat.js"],"sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { Comet } from \"../api\";\nimport '../styles/GroupChat.css';\nimport Navbar from \"./Navbar\";\n\nconst GroupChat = () => {\n\n    const INIT_STATE = {\n        text: \"\"\n    }\n\n    const [formData, setFormData] = useState(INIT_STATE);\n    const [messages, setMessages] = useState();\n    const [trigger, setTrigger] = useState();\n    const uid = localStorage.getItem(\"uid\")\n    const {guid} = useParams();\n    const ws = new WebSocket(`wss://janusapi.herokuapp.com/api/ws/chat`)\n\n    \n\n    useEffect(() => {\n        function fetchGroupMessagesAndSend() {\n            ws.onopen = function(evt){\n                ws.send(guid)\n            }\n\n             ws.onmessage = function(evt) {\n                // console.log(JSON.parse(evt.data)) \n                let data = JSON.parse(evt.data)\n\n                if(data === []) {\n                    setMessages(null);\n                }\n                else {\n                    setMessages(data);\n                    }\n            }\n        }\n        fetchGroupMessagesAndSend();\n    })\n\n    useEffect(() => {\n        function fetchGroupMessagesOnce() {\n            setTimeout(function(){\n                let messageBody = document.querySelector('.message-list');\n\n                if(messageBody) {\n                    messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;\n                }\n            },700)\n            \n        }\n        fetchGroupMessagesOnce()\n    }, [])\n\n\n    const sendMessage = async () => {\n        await Comet.sendMessage(guid, formData.text, uid);\n    } \n\n    const handleChange = (e) => {\n        const {name, value} = e.target;\n        setFormData(formData => ({\n            ...formData,\n            [name]: value\n        }))\n        let messageBody = document.querySelector('.message-list');\n        if(messageBody) {\n            messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;\n        }\n    }\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        sendMessage()\n        setFormData(INIT_STATE);\n        let messageBody = document.querySelector('.message-list');\n        if(messageBody) {\n            messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;\n        }\n    }\n\n\n    const details = messages ? \n        <>\n            <ul className=\"message-list\">\n                {messages.map(message => {\n\n                    if(!message.deletedAt) {\n                        if(message.sender === uid.toLowerCase()) {\n                            return <li className=\"sender\" >{message.data.text}</li>\n                        }\n\n                        return (\n                            <>\n                                <span className=\"message-name\" >{message.sender}</span>\n                                <li className=\"receiver\" >{message.data.text}</li>\n                            </>\n                        )\n                    }\n                })}\n            </ul>\n        </> \n        : null;\n\n    return (\n        <>\n        \n            <Navbar/>\n            <div className=\"GroupChat\">\n            \n            <div className=\"GroupChat-messages\">\n                <div className=\"messages-border\"></div>\n                {details}\n                \n            </div>\n            <form className=\"GroupChat-form\" onSubmit={handleSubmit}>\n                <input\n                    name=\"text\" \n                    placeholder=\"Type Message\" \n                    value={formData.text}\n                    onChange={handleChange}\n                    />\n                    <button>Send</button>\n            </form>\n        </div>\n        \n        </>\n        \n    )\n\n}\nexport default GroupChat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}